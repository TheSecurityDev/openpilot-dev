<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UI Diff Report</title>
  <style>
    body { font-family: sans-serif; margin: 1em; }
    h2, h4 { margin: 0.5em 0 0.25em; }
    #nav { display: flex; flex-wrap: wrap; gap: 0.4em; margin: 0.75em 0; }
    #nav button { padding: 0.35em 0.75em; border: 1px solid #aaa; border-radius: 4px; cursor: pointer; background: #f5f5f5; }
    #nav button.active { background: #0078d4; color: #fff; border-color: #0078d4; }
    table.videos { width: 100%; }
    @media (max-width: 800px) {
      table.videos tr { display: flex; flex-direction: column; }
      table.videos td { width: 100% !important; }
    }
  </style>
</head>
<body>
  <h2>UI Diff</h2>
  <p><strong>Results:</strong> $RESULT_TEXT</p>
  <div id='player'></div>
  <div id='nav'></div>
  <script>
    const LABELS = ['Video 1', 'Video 2', 'Pixel Diff'];
    const chunks = $CHUNKS_JSON;

    const scenes = [
      { label: 'Full Video', srcs: ['$VIDEO1_SRC', '$VIDEO2_SRC', '$DIFF_SRC'], loop: false },
      ...chunks.map(({ start_frame, end_frame, duration, clips }, i) => ({
        label: `Section ${i + 1}: frames ${start_frame}\u2013${end_frame} (${duration}f)`,
        srcs: [clips.video1, clips.video2, clips.diff],
        loop: true,
      })),
    ];

    // Static 3-video player â€” sources are swapped on scene change.
    document.getElementById('player').innerHTML = `<table class='videos'><tbody><tr>
      ${LABELS.map((lbl, i) => `<td width='33%'><h4>${lbl}</h4>
        <video id='v${i}' width='100%' muted playsinline><source type='video/mp4'></video></td>`).join('')}
    </tr></tbody></table>`;
    const vids = [0, 1, 2].map(i => document.getElementById(`v${i}`));

    // Sync: keep all three videos at the same playhead.
    const isEnded = v => v.ended || (Number.isFinite(v.duration) && v.currentTime >= v.duration - 0.05);
    vids.forEach(v => {
      v.addEventListener('timeupdate', () => vids.forEach(o => {
        if (o !== v && !isEnded(o) && Math.abs(v.currentTime - o.currentTime) > 0.1) {
          o.currentTime = v.currentTime;
          if (o.paused) o.play();
        }
      }));
      v.addEventListener('ended', () => {
        v.pause();
        if (vids.every(isEnded)) { vids.forEach(v => { v.currentTime = 0; v.play(); }); }
      });
    });

    // Switch to a scene: swap sources, reload, play.
    function switchTo(i) {
      vids.forEach(v => v.pause());
      const { srcs, loop } = scenes[i];
      vids.forEach((v, j) => { v.loop = loop; v.querySelector('source').src = srcs[j]; v.load(); v.play().catch(() => {}); });
      document.querySelectorAll('#nav button').forEach((b, j) => b.classList.toggle('active', j === i));
    }

    // Build nav buttons.
    const navEl = document.getElementById('nav');
    scenes.forEach((s, i) => {
      const b = document.createElement('button');
      b.textContent = s.label;
      b.onclick = () => switchTo(i);
      navEl.appendChild(b);
    });

    switchTo(0);
  </script>
</body>
</html>
